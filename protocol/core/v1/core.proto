syntax = "proto3";

import "google/protobuf/empty.proto";

package protocol.core.v1;

option go_package = "core;corev1";

// EMBEDS AND ACTIONS

enum ActionType {
  Normal = 0;
  Primary = 1;
  Destructive = 2;
}

enum ActionPresentation {
  Button = 0;
  Dropdown = 1;
  Menu = 2;
  SmallEntry = 3;
  LargeEntr = 4;
}

enum FieldPresentation {
  Data = 0;
  CaptionedImage = 1;
  Row = 2;
}

message Action {
	string text = 1;
	string url = 2;
	string id = 3;
	ActionType type = 4;
	repeated Action children = 5;
}

message EmbedHeading {
	string text = 1;
	string subtext = 2;
	string url = 3;
	string icon = 4;
}

message EmbedField {
	string title = 1;
	string subtitle = 2;
	string body = 3;

	string image_url = 4;

	FieldPresentation presentation = 5;

	repeated Action actions = 6;
}

message Embed {
	string title = 1;
	string body = 2;

	int64 color = 3;

	optional EmbedHeading header = 4;
	optional EmbedHeading footer = 5;

	repeated EmbedField fields = 6;
	repeated Action actions = 7;
}

// CREATE

message CreateGuildRequest {
  string guild_name = 1;
  optional string picture_url = 2;
}
message CreateGuildResponse {
  uint64 guild_id = 1;
}

message CreateInviteRequest {
  string name = 1;
  uint64 for_guild = 2;
  optional int32 possible_uses = 3;
}
message CreateInviteResponse {
  string name = 1;
}

message CreateChannelRequest {
  uint64 guild_id = 1;
  string channel_name = 2;
}
message CreateChannelResponse {
  uint64 channel_id = 1;
}

// READ

message GetGuildRequest { uint64 guild_id = 1; }
message GetGuildResponse {
  string guild_name = 1;
  uint64 guild_owner = 2;
  string guild_picture = 3;
}

message GetGuildInvitesRequest { uint64 guild_id = 1; }
message GetGuildInvitesResponse {
  message Invite {
    uint64 invite_id = 2;
    int32 possible_uses = 3;
    int32 use_count = 4;
  }
  repeated Invite invites = 1;
}

message GetGuildMembersRequest { uint64 guild_id = 1; }
message GetGuildMembersResponse { repeated uint64 members = 1; }

message GetGuildChannelsRequest { uint64 guild_id = 1; }
message GetGuildChannelsResponse {
  message Channel {
    uint64 channel_id = 1;
    string channel_name = 2;
  }

  repeated Channel channels = 1;
}

message GetChannelMessagesRequest { uint64 load_before_message = 1; }
message GetChannelMessagesResponse {
  message Message {
    uint64 guild_id = 1;
    uint64 channel_id = 2;
    uint64 message_id = 3;
    uint64 author_id = 4;
    uint64 created_at = 5;
    uint64 edited_at = 6;
		string content = 7;
		repeated Embed embeds = 8;
		repeated Action actions = 9;
  }
  repeated Message messages = 1;
}

// UPDATE

message UpdateGuildNameRequest {
  uint64 guild_id = 1;
  string new_guild_name = 2;
}
message UpdateGuildNameResponse { bool success = 1; }

message UpdateMessageRequest {
	string content = 1;
	repeated Embed embeds = 2;
	repeated Action actions = 3;
}

// DELETE

message DeleteGuildRequest { uint64 guild_id = 1; }

message DeleteInviteRequest { string invite_code = 1; }

message DeleteChannelRequest {
  uint64 guild_id = 1;
  uint64 channel_id = 2;
}

message DeleteMessageRequest {
  uint64 guild_id = 1;
  uint64 channel_id = 2;
  uint64 message_id = 3;
}

service CoreService {
  rpc CreateGuild(CreateGuildRequest) returns (CreateGuildResponse) {}
  rpc CreateInvite(CreateInviteRequest) returns (CreateInviteResponse) {}
  rpc CreateChannel(CreateChannelRequest) returns (CreateChannelResponse) {}

  rpc GetGuild(GetGuildRequest) returns (GetGuildResponse) {}
  rpc GetGuildInvites(GetGuildInvitesRequest)
      returns (GetGuildInvitesResponse) {}
  rpc GetGuildMembers(GetGuildMembersRequest)
      returns (GetGuildMembersResponse) {}
  rpc GetGuildChannels(GetGuildChannelsRequest)
      returns (GetGuildChannelsResponse) {}
  rpc GetChannelMessages(GetChannelMessagesRequest)
      returns (GetChannelMessagesResponse) {}

  rpc UpdateGuildName(UpdateGuildNameRequest)
      returns (UpdateGuildNameResponse) {}
  rpc UpdateMessage(UpdateMessageRequest) returns (google.protobuf.Empty) {}

  rpc DeleteGuild(DeleteGuildRequest) returns (google.protobuf.Empty) {}
  rpc DeleteInvite(DeleteInviteRequest) returns (google.protobuf.Empty) {}
  rpc DeleteChannel(DeleteChannelRequest) returns (google.protobuf.Empty) {}
  rpc DeleteMessage(DeleteMessageRequest) returns (google.protobuf.Empty) {}
}